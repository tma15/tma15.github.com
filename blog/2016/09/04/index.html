<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Early updateは収束が保証される</title>

 	
	<link href="/css/journal.css" rel="stylesheet">

 	
 	<link href="/css/style.css" rel="stylesheet">
</head>
<body lang="en">
	<div class="container">
		<div class="row">
			<div class="navbar navbar-default navbar-inverse" role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="http://tma15.github.io/">Now is better than never.</a> 
				</div>
				<div class="navbar-collapse collapse navbar-responsive-collapse">
					<ul class="nav navbar-nav navbar-right">
						<li><a href="http://tma15.github.io/">Home</a></li>
						<li><a href="http://tma15.github.io//about/">About</a></li>
						<li><a href="http://tma15.github.io//blog/">Blog</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>


<div class="container">	
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<h3>Early updateは収束が保証される</h3>
				<span class="label label-primary">Sun Sep 4, 2016</span> in 
				 using tags 			 
				
					
					<a href="/tags/machine_learning">machine_learning</a>
				
			</small>
		</div>
	</div>
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<br>
			

<p>(<a href="http://www.aclweb.org/anthology/N12-1015">Structured Perceptron with Inexact Search</a>, NAACL 2012) を読んだ。</p>

<p>構造化パーセプトロンは構造を持つ出力を予測するパーセプトロンであり、自然言語処理では品詞タグ付けなどに用いられる。出力を予測する際には効率的に出力を探索するために、ビームサーチが用いられることが多いが、一般的な構造化パーセプトロンに対してビームサーチを適用すると、パーセプトロンの収束性が保証されない。</p>

<p>構造化パーセプトロンを効率的に学習する手法として、early updateというヒューリスティクスな手法が提案されている。early updateは出力を予測する途中で正解でないとわかった段階で場合に重みを更新するヒューリスティクスな手法である。しかしながら、early updateはラベル列を最後まで見ずに重みを更新するのにも関わらず、violation fixingという枠組みで収束が保証される。</p>

<h2 id="violation:ea6ca57e2b11cd721c55720df169800b">violation</h2>

<p>violationは構造化パーセプトロンの収束を考えるために必要な定義である。
violationを定義するために、インスタンス$x$と正解のラベル列$y$と、正解以外のラベル列$z$の組を考える。
モデルによって計算される正解のスコア$\mathbf{w}\cdot\mathbf{\phi(x,y)}$が不正解のスコア$\mathbf{w}\cdot\mathbf{\phi(x,z)}$よりも高い
組をviolationという。
言い換えると、重みベクトル$\mathbf{w}$に対して、$\mathbf{w}\cdot\Delta\mathbf{\phi}(x,y,z)\leq 0$
のとき、$(x,y,z)$はvilolationであるという。ただし、$\Delta \phi(x,y,z)=\phi(x,y)-\phi(x,z)$とする。</p>

<h2 id="構造化パーセプトロン:ea6ca57e2b11cd721c55720df169800b">構造化パーセプトロン</h2>

<p>ここでは構造化パーセプトロンの収束がviolationによって決まることを追う。
さらに、近似的な探索ではviolationでなくなる可能性が出てしまい、収束性の保証が無くなることを追う。</p>

<h3 id="概要:ea6ca57e2b11cd721c55720df169800b">概要</h3>

<p>構造化パーセプトロンはラベルを出力するために、インスタンスに対してスコアが最大となるパス$z$をありうるラベル列の集合$\mathcal{Y}(x)$の中から探索する:
$$
z = \arg \max_{s \in \mathcal{Y}(x)} \mathbf{w} \phi(x,s).
$$</p>

<p>$z$は正解を含めて、ありうる候補の中で最大のスコア、つまり$\forall z&rsquo; \in \mathcal{Y}(x), \mathbf{w}\phi(x,z&rsquo;)\leq \mathbf{w}\phi(x,z)$である。
更新時は$z \neq y$であるため、構造化パーセプトロンが重みの更新に利用する$(x,y,z)$はすべてviolationである。</p>

<h3 id="収束性:ea6ca57e2b11cd721c55720df169800b">収束性</h3>

<p>学習データ中で最大となる正解のスコアと不正解のスコアの差を$R$とする:
$$
R=\max_{(x,y,z)\in C}|\Delta \mathbf{\phi}(x,y,z)|,
$$</p>

<p>$|\mathbf{u}|=1$であるような重みベクトル$\mathbf{u}$が存在し、$\forall (x,y,z)\in C, \mathbf{u}\cdot \Delta \mathbf{\phi}(x,y,z)\geq \delta$
であるとき、学習データは線形分離可能であるという。$\delta$は次のように定義される:
$$
\delta = \max_{\mathbf{u}=1} \min_{(x,y,z)\in C} \mathbf{u} \cdot \Delta \mathbf{\phi}(x,y,z),
$$</p>

<p>学習データが線形分離可能であれば、パーセプトロンは有限回の更新で収束する:</p>

<p>$$
\textrm{err}\leq R^2/\delta^2
$$</p>

<h3 id="証明:ea6ca57e2b11cd721c55720df169800b">証明</h3>

<p>証明を追うのが面倒な場合は、証明中に$\arg \max$が出てこないということ、出てくるのはviolation、つまり$\mathbf{u} \cdot \Delta \phi(x,y,z)\leq 0$となる$(x,y,z)$であることを心に留めておけば読み飛ばしても大丈夫。</p>

<p>重みの更新則は$\mathbf{w}^{(k+1)}=\mathbf{w}^(k)+\Delta \mathbf{\phi}(x,y,z)$
であるため、</p>

<p>$$
\begin{eqnarray}
\mathbf{u}\cdot \mathbf{w}^{(k+1)}&amp;=&amp;\mathbf{u}\cdot \mathbf{w}^{(k)}+\mathbf{u}\cdot \Delta \mathbf{\phi}(x,y,z) \\
&amp;\geq&amp; \mathbf{u} \cdot \mathbf{w}^{(k)}+\delta \\
&amp;\geq&amp; \mathbf{u} \cdot \mathbf{w}^{(k-1)}+\delta+\delta \\
&amp;&hellip;&amp; \\
&amp;\geq&amp; \mathbf{u} \cdot \mathbf{w}^{(0)}+k\delta.
\end{eqnarray}
$$</p>

<p>$\mathbf{w}^{(0)}=\mathbf{0}$より、</p>

<p>$$
\mathbf{u}\cdot \mathbf{w}^{(k+1)} = k\delta.
$$</p>

<p>また、コーシー・シュワルツの不等式 (任意の二つのベクトル$\mathbf{a}, \mathbf{b}$について$|\mathbf{a}||\mathbf{b}|\geq \mathbf{a}\cdot\mathbf{b}$) より</p>

<p>$$
|\mathbf{u}||\mathbf{w}^{(k+1)}|\geq \mathbf{u} \cdot \mathbf{w}^{(k+1)}\geq k\delta
$$</p>

<p>また$|\mathbf{u}|=1$より、</p>

<p>$$
|\mathbf{w}^{(k+1)}| \geq k\delta
$$</p>

<p>が成り立つ。
ここで、$|\mathbf{a}+\mathbf{b}|^2=|\mathbf{a}|^2 + |\mathbf{b}|^2 + 2\mathbf{a}\cdot \mathbf{b}$であること、
および重みを更新する条件が正解のラベル列のスコアが不正解のラベル列のスコアよりも低い場合 ($\mathbf{w}^{(k)}\cdot \Delta \mathbf{\phi}(x,y,z) \leq 0$)
であることより、</p>

<p>$$
\begin{eqnarray}
|\mathbf{w}^{(k+1)}|^2 &amp;=&amp; |\mathbf{w}^{(k)}+\Delta \mathbf{\phi}(x,y,z)|^2 \\
&amp;=&amp; |\mathbf{w}^{(k)}|^2 + |\Delta \mathbf{\phi}(x,y,z)|^2 + 2 \mathbf{w}^{(k)} \cdot \Delta \mathbf{\phi}(x,y,z) \\
&amp;\leq&amp; |\mathbf{w}^{(k)}|^2 + R^2 + 0 \\
&amp;\leq&amp; |\mathbf{w}^{(k-1)}|^2 + R^2 + R^2 \\
&amp;&hellip;&amp; \\
&amp;\leq&amp; kR^2.
\end{eqnarray}
$$</p>

<p>$|\mathbf{w}^{(k+1)}| \geq k\delta$および$|\mathbf{w}^{(k+1)}|^2 \leq kR^2$より、有限回の更新で収束する:</p>

<p>$$
k \leq R^2/\delta^2.
$$</p>

<p>パーセプトロンの収束性の証明は、厳密解 (argmax) に依存しない。かわりにviolationに依存する。</p>

<h3 id="近似的な探索では収束が保証されない:ea6ca57e2b11cd721c55720df169800b">近似的な探索では収束が保証されない</h3>

<p>近似的な探索では探索空間の部分集合に対して、ラベル列を探索する。そのため、正解のラベル列が
探索空間の部分集合に存在しないということがあって、かつ$\Delta \phi(x,y,z)\gt 0$、つまり
正解のラベル列のスコアが不正解のラベル列のスコアよりも大きい場合がある。この場合、$(x,y,z)$
はviolationではない。よって、構造化パーセプトロンの収束性は保証されない (<a href="http://www.aclweb.org/anthology/N12-1015">Structured Perceptron with Inexact Search</a> Figure 1の例を参照)。</p>

<p>自然言語処理では探索空間が大きく、ビームサーチのような近似的な探索手法が用いられることがあるため、
このようなモデルのスコア計算に問題はなくても、近似的な探索をするために正解が探索空間から枝切りされてしまうという状況が起きうる。</p>

<h2 id="ビームサーチとearly-update:ea6ca57e2b11cd721c55720df169800b">ビームサーチとearly update</h2>

<p>early updateを用いた構造化パーセプトロンの学習は以下のようになる:</p>

<pre><code>for (x, y) in D:
  (x, y', z) = FIND_VIOLATION(x, y, w)
  if y' != z:
    w += phi(x, y') - phi(x, z)
</code></pre>

<p>FIND_VIOLATIONではビームサーチをおこない、ビームサーチが保持する仮説のリストから正解が漏れた段階で正解のラベル列と最大のスコアの予測ラベル列を返す:</p>

<pre><code># B[][]: 位置iにおいてスコアが高い上位k個の仮説を保持するリスト
function FIND_VIOLATION(x, y, w)
  B[0] = []
  for i in |x|
    B[i] = BEST(x, B[i-1], k) ### スコアが高い上位k個の仮説を得る
    if not y[:i] in B[i]: ### i番目までの正解のラベル列がビームサーチの探索範囲から漏れてしまった場合
      return (x, y[:i], B[i][0]) ### ビームサーチの中で最大のスコアの仮説を返す
  return (x, y, B[|x|][0])
</code></pre>

<p><code>B</code>はスコアが高い上位の仮説を保持するリストであるから、正解が<code>B</code>に入っていない場合、正解のスコアは
<code>B</code>に入っている仮説よりもスコアが低い。
early updateでは正解の部分ラベル列y&rsquo;のスコアと、ビームサーチが保持する仮説の中でスコアが最大のラベル列z (<code>B[i][0]</code>もしくは<code>B[|x|][0]</code>) のスコアに対して、
$\mathbf{w}\cdot \phi(x,y&rsquo;)\leq \mathbf{w}\cdot \phi(x,z)$、つまり$\Delta \phi(x,y&rsquo;,z)\leq 0$となる。
よって、early updateで重みの学習に用いるデータはすべてviolationである。
そのため、early updateも、通常の構造化パーセプトロンの収束の証明と同じように、収束を証明できる。</p>

<h2 id="まとめ:ea6ca57e2b11cd721c55720df169800b">まとめ</h2>

<p>early updateは収束が保証される。</p>

		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<hr>
		</div>
	</div>	
        <div id="disqus_thread"></div>
<script type="text/javascript">
     
    var disqus_shortname = 'nowisbetterthannever'; 

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

  <div class="container">
    <div class="row col-md-12">
          <footer>
            <div>
                <p>
                    &copy; 2014  ~ Powered By <a href="http://hugo.spf13.com">Hugo</a>
                </p>
            </div>
            </footer>
        </div>
    </div>

    
    
    <script src="/js/jquery-min-2.1.1.js"></script>
    <script src="/js/bootstrap.min-3.1.1.js"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: { inlineMath: [['$','$'],['\\(','\\)']] }
        });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20414370-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </body>
</html>

