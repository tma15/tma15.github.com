<!doctype html>
<html lang="ja">
    <head>
        <link href="http://fonts.googleapis.com/css?family=Anton" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Bubblegum+Sans' rel='stylesheet' type='text/css'>
        <title>Goで日本語の文書を前処理して分類器を学習するところまでやってみる | Now is better than never.</title>
        <meta charset="utf-8" />
        <link href='http://fonts.googleapis.com/css?family=Permanent+Marker' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/media/css/font-awesome.css">
        <link rel="stylesheet" href="/media/css/style.css">
        <link rel="stylesheet" href="/media/css/pygments.css">
        <link rel="shortcut icon" href="/media/img/background.jpg">
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: { inlineMath: [['$','$'],['\\(','\\)']] }
            });
        </script>
        <script type='text/javascript' src='http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
        <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js">
        </script>
        <![endif]-->
    </head>
    <body >
        <header>
            <hgroup>
              <h1>Now is better than never.</h1>
              <h3>Although never is often better than right now.</h3>
            </hgroup>
        </header>
        <nav>
                                <ul>
<li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/blog">Blog</a></li><li><a href="/blog/archive.html">Archive</a></li></ul>
        </nav>
        <article id="content">
                    <h1>Goで日本語の文書を前処理して分類器を学習するところまでやってみる</h1>
              <div class="tags">
        Tags:
            <a class="small" href="/blog/tags/golang.html">golang</a>&nbsp;
            <a class="small" href="/blog/tags/nlp.html">nlp</a>&nbsp;
            <br>
  </div>
            <h2>概要</h2>
<p>日本語の文書を単純な方法で分類器を学習するところまでの一連の処理をGoでやってみる。
分類器は何でも良いのだけど、先日書いた<a href="https://github.com/tma15/goAdaGrad">AdaGrad+RDA</a>を使う。</p>
<p>ラベルが付いた日本語のデータがあるという前提で、以下の流れで進める。</p>
<ul>
<li>文書を文に分割する。今回は「。」で区切る。</li>
<li>文を形態素解析して名詞や動詞(表層形)を取り出し、文書をある単語を含む、含まないの二値で表現した素性ベクトルに変換する。</li>
<li>訓練データを使って分類器を学習して、できたモデルの中身を見てみる。</li>
</ul>
<h2>データ</h2>
<p>下記URLから得られるテキストの一部を使って、ラベルをそれぞれ、「スポーツ」、「政治」、「Go言語」とラベルを付与し、第一カラムをラベル、第二カラムを文書としたCSVに保存しておく。</p>
<ul>
<li><a href="http://mainichi.jp/sponichi/news/20141020spn00m050016000c.html">本田圭佑:セリエＡ日本人４人目マルチ!惨敗ブラジル戦憂さ晴らし</a></li>
<li><a href="http://www.yomiuri.co.jp/politics/20141020-OYT1T50026.html">観劇収支ズレどう説明、公私混同疑いも…小渕氏</a></li>
<li><a href="http://ascii.jp/elem/000/000/935/935886/">古いプログラミング言語がなくならない理由</a></li>
</ul>
<div class="codebox"><figure class="code"><div class="highlight"><pre><span class="nv">$cat</span> data.csv<br />スポーツ,ＡＣミランＦＷ本田圭佑（２８）が１９日のアウェー、ベローナ戦で...<br />政治,渕経済産業相が関連する政治団体の資金処理問題で、最も不透明と指摘されて...<br />Go言語,編集者とこの本を5000部売れたらなという話をしたのをなんとなく覚えている。...<br /></pre></div><br /><figcaption>Bash</figcaption></figure></div>

<p>...以降は省略している。</p>
<h2>ソースコード</h2>
<ul>
<li><a href="https://gist.github.com/tma15/094abc128ad62e16cfed#file-mecab-go">mecab.go</a> (gist)</li>
<li><a href="https://gist.github.com/tma15/094abc128ad62e16cfed#file-text-go">text.go</a> (gist)</li>
</ul>
<h2>動かしてみる</h2>
<div class="codebox"><figure class="code"><div class="highlight"><pre><span class="nv">$.</span>/text data.csv &gt; data<br /><span class="nv">$cat</span> data<br />スポーツ ２:1.000000 スルー:1.000000 本田:1.000000 セリエＡ:1.000000 アルゼンチン:1.000000... <br />政治 円:1.000000 なる:1.000000 者:1.000000 向け:1.000000 会:1.000000 収支:1.000000...<br />Go言語 処理:1.000000 ため:1.000000 Go:1.000000 編集:1.000000 5000:1.000000...<br /></pre></div><br /><figcaption>Bash</figcaption></figure></div>

<p>...以降は省略している。これで、dataファイルに素性ベクトルが書き込まれる。
次に分類器を学習する。</p>
<div class="codebox"><figure class="code"><div class="highlight"><pre><span class="nv">$.</span>/adagrad -f data -m learn -w model<br /></pre></div><br /><figcaption>Bash</figcaption></figure></div>

<p>できあがったモデルの中身を見てみる。</p>
<div class="codebox"><figure class="code"><div class="highlight"><pre><span class="nv">$cat</span> model|grep <span class="s2">&quot;^スポーツ&quot;</span>|sort -k3 -nr|head<br />スポーツ        カルロス・テベス        0.600000<br />スポーツ        モチベーション  0.600000<br />スポーツ        アルゼンチン    0.600000<br />スポーツ        ＡＣミラン      0.600000<br />スポーツ        ユベントス      0.600000<br />スポーツ        抜け出し        0.600000<br />スポーツ        ベローナ        0.600000<br />スポーツ        ブラジル        0.600000<br />スポーツ        セリエＡ        0.600000<br />スポーツ        アウェー        0.600000<br /><span class="nv">$cat</span> model|grep <span class="s2">&quot;^政治&quot;</span>|sort -k3 -nr|head<br />政治    不透明  0.800000<br />政治    上回っ  0.800000<br />政治    関連    0.800000<br />政治    資金    0.800000<br />政治    説明    0.800000<br />政治    観劇    0.800000<br />政治    経済    0.800000<br />政治    産業    0.800000<br />政治    生じ    0.800000<br />政治    焦点    0.800000<br /><span class="nv">$cat</span> model|grep <span class="s2">&quot;^Go言語&quot;</span>|sort -k3 -nr|head<br />Go言語  インタビュー    0.700000<br />Go言語  カーニハン      0.700000<br />Go言語  グーグル        0.700000<br />Go言語  代わる  0.700000<br />Go言語  それら  0.700000<br />Go言語  いくら  0.700000<br />Go言語  言語    0.700000<br />Go言語  解決    0.700000<br />Go言語  覚え    0.700000<br />Go言語  考え    0.700000<br /></pre></div><br /><figcaption>Bash</figcaption></figure></div>

<p>一行が素性の重みを表していて、タブ区切りで左から順に、ラベル、素性、素性の重みとなっている。
たとえば、「カルロス・テベス」という素性の重みは、「スポーツ」というラベルで0.6の重みを持つことを表している。
このモデルでラベルが未知の文書を分類するとき、「カルロス・テベス」が出現しているほどその文書のラベルは「スポーツ」になりやすいし、「不透明」が出現しているほどラベルは「政治」になりやすい。</p>
<h2>まとめ</h2>
<p>自然言語処理でよく使う単純な前処理をGoで書いた。
あとは、文字の半角、全角の統一とか色々とよくありそうな前処理あたりをもっと調べたい。</p>
        <br>
        <time datetime="2014-10-20">
    Mon, 20 Oct 2014
</time>
        <div class="bottom_article_nav">

                  <div class="next"><a href="/blog/2014/10/go-adagrad.html">AdaGrad+RDAをGoで書いた</a>
    &gt;</div>
        <div class="prev">&lt; <a href="/blog/2014/10/hmm.html">HMMを実装した</a>
  </div>

</div>

<div class="center"><a href="/blog/archive.html">archive</a></div>
        </article>

                <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-20414370-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>    </body>
</html>